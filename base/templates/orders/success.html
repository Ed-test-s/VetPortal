{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Заказ #{{ order.order_number }}</h2>
  <p>Статус: <strong>{{ order.get_status_display }}</strong></p>

  <h4 class="mt-3">Товары</h4>
  <ul class="list-group mb-3">
    {% for item in items %}
      <li class="list-group-item d-flex justify-content-between">
        <div>
          <strong>{{ item.pharmacy_medicine.medicine.name }}</strong>
          <div class="small text-muted">{{ item.pharmacy_medicine.pharmacy.name }}</div>
        </div>
        <div>{{ item.quantity }} × {{ item.price_at_purchase|floatformat:2 }} BYN</div>
      </li>
    {% endfor %}
  </ul>

  <div class="mb-3">
    Итог: <strong>{{ order.total_price|floatformat:2 }} BYN</strong>
  </div>

  <h4>Коды получения / QR</h4>
  {% for p in pickups %}
    <div class="card mb-2">
      <div class="card-body d-flex align-items-center">
        <div>
          {% if p.pharmacy %}
            <div class="fw-bold">{{ p.pharmacy.name }}</div>
            <div class="small text-muted">{{ p.pharmacy.address }}</div>
          {% endif %}
          <div>Код: <strong>{{ p.pickup_code }}</strong></div>
        </div>
        <div class="ms-auto">
          {% if p.qr %}
            <img src="{{ p.qr }}" alt="QR" style="height:120px;">
          {% else %}
            <div class="small text-muted">QR недоступен (не установлена библиотека)</div>
          {% endif %}
        </div>
      </div>
    </div>
  {% endfor %}

  <a href="{% url 'order_history' %}" class="btn btn-primary mt-3">Перейти в историю заказов</a>
</div>
{% endblock %}
